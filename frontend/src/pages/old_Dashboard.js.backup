import React, { useState, useEffect } from 'react';
import { 
  Typography, 
  Grid, 
  Card, 
  CardContent,
  Box,
  CircularProgress
} from '@mui/material';
import {
  People as PeopleIcon,
  EventAvailable as EventIcon,
  AttachMoney as MoneyIcon,
  Work as WorkIcon
} from '@mui/icons-material';
import employeeService from '../services/employeeService';

function Dashboard() {
  const [stats, setStats] = useState({
    totalEmployees: 0,
    departments: {},
    newHires: 0
  });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    try {
      setLoading(true);
      const dashboardData = await employeeService.getDashboardStats();
      setStats({
        totalEmployees: dashboardData.total_employees || 0,
        departments: dashboardData.departments || {},
        newHires: dashboardData.new_hires_this_month || 0
      });
    } catch (error) {
      console.error('Dashboard verileri yüklenirken hata:', error);
      // Backend çalışmıyorsa mock data kullan
      setStats({
        totalEmployees: 24,
        departments: { 'IT': 8, 'HR': 4, 'Sales': 6, 'Marketing': 6 },
        newHires: 2
      });
    } finally {
      setLoading(false);
    }
  };

  const StatCard = ({ title, value, icon, color }) => (
    <Card sx={{ 
      height: '100%',
      background: 'linear-gradient(135deg, rgba(28, 97, 171, 0.05), rgba(139, 185, 74, 0.05))', // Optima renkleri
      backdropFilter: 'blur(15px)',
      border: '1px solid rgba(28, 97, 171, 0.2)',
      borderRadius: '16px',
      boxShadow: '0 8px 32px rgba(28, 97, 171, 0.1)',
      transition: 'all 0.3s ease',
      '&:hover': {
        transform: 'translateY(-5px)',
        boxShadow: '0 16px 40px rgba(28, 97, 171, 0.2)',
        border: '1px solid rgba(139, 185, 74, 0.3)'
      }
    }}>
      <CardContent>
        <Box display="flex" alignItems="center" justifyContent="space-between">
          <Box>
            <Typography color="textSecondary" gutterBottom variant="body2">
              {title}
            </Typography>
            <Typography variant="h4" component="h2">
              {value}
            </Typography>
          </Box>
          <Box sx={{ color: color }}>
            {icon}
          </Box>
        </Box>
      </CardContent>
    </Card>
  );

  if (loading) {
    return (
      <Box display="flex" justifyContent="center" alignItems="center" minHeight="400px">
        <CircularProgress />
      </Box>
    );
  }

  return (
    <Box>
      <Typography variant="h4" component="h1" gutterBottom>
        Dashboard
      </Typography>
      
      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} sm={6} md={3}>
          <StatCard 
            title="Toplam Çalışan"
            value={stats.totalEmployees}
            icon={<PeopleIcon fontSize="large" />}
            color="#1c61ab" // Optima mavi
          />
        </Grid>
        
        <Grid item xs={12} sm={6} md={3}>
          <StatCard 
            title="Bu Ay İşe Girenler"
            value={stats.newHires}
            icon={<EventIcon fontSize="large" />}
            color="#8bb94a" // Optima yeşil
          />
        </Grid>
        
        <Grid item xs={12} sm={6} md={3}>
          <StatCard 
            title="Aktif Departman"
            value={Object.keys(stats.departments).length}
            icon={<WorkIcon fontSize="large" />}
            color="#1c61ab" // Optima mavi
          />
        </Grid>
        
        <Grid item xs={12} sm={6} md={3}>
          <StatCard 
            title="Ortalama Çalışan/Dept"
            value={Math.round(stats.totalEmployees / Math.max(Object.keys(stats.departments).length, 1))}
            icon={<MoneyIcon fontSize="large" />}
            color="#8bb94a" // Optima yeşil
          />
        </Grid>
      </Grid>

      <Grid container spacing={3}>
        <Grid item xs={12} md={6}>
          <Card sx={{
            background: 'linear-gradient(135deg, rgba(28, 97, 171, 0.05), rgba(139, 185, 74, 0.05))',
            backdropFilter: 'blur(15px)',
            border: '1px solid rgba(28, 97, 171, 0.2)',
            borderRadius: '16px',
            boxShadow: '0 8px 32px rgba(28, 97, 171, 0.1)',
            transition: 'all 0.3s ease',
            '&:hover': {
              transform: 'translateY(-3px)',
              boxShadow: '0 12px 36px rgba(28, 97, 171, 0.15)'
            }
          }}>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                Departman Dağılımı
              </Typography>
              {Object.entries(stats.departments).map(([dept, count]) => (
                <Box key={dept} display="flex" justifyContent="space-between" alignItems="center" mb={1}>
                  <Typography>{dept}</Typography>
                  <Typography fontWeight="bold">{count} kişi</Typography>
                </Box>
              ))}
            </CardContent>
          </Card>
        </Grid>

        <Grid item xs={12} md={6}>
          <Card sx={{
            background: 'linear-gradient(135deg, rgba(28, 97, 171, 0.05), rgba(139, 185, 74, 0.05))',
            backdropFilter: 'blur(15px)',
            border: '1px solid rgba(28, 97, 171, 0.2)',
            borderRadius: '16px',
            boxShadow: '0 8px 32px rgba(28, 97, 171, 0.1)',
            transition: 'all 0.3s ease',
            '&:hover': {
              transform: 'translateY(-3px)',
              boxShadow: '0 12px 36px rgba(28, 97, 171, 0.15)'
            }
          }}>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                Hızlı İstatistikler
              </Typography>
              <Box>
                <Typography variant="body2" color="textSecondary" mb={1}>
                  • Sistemde {stats.totalEmployees} aktif çalışan bulunuyor
                </Typography>
                <Typography variant="body2" color="textSecondary" mb={1}>
                  • Bu ay {stats.newHires} yeni çalışan işe başladı
                </Typography>
                <Typography variant="body2" color="textSecondary" mb={1}>
                  • {Object.keys(stats.departments).length} farklı departman aktif
                </Typography>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
}

export default Dashboard;
